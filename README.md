# Flavor Logs API
A Node, Express, PostgreSQL back-end for the Flavor Logs app. This Flavor Logs database contains a table for Flavor Logs and a table for Eateries. Each Eatery added will have a corresponding ID which will reference the correct Flavor Log in this database. The API endpoings also enable CRUD operations.
[Live App Demo](https://flavor-logs-app.now.sh/) | [Front-end Client Repo](https://github.com/Jadedtofu/flavor-logs-app)

## Technologies Used
- [Express](https://expressjs.com/)
- [Node.js](https://nodejs.org/en/)
- [Nodemon](https://www.npmjs.com/package/nodemon)
- [Dotenv](https://www.npmjs.com/package/dotenv)
- [Morgan](https://www.npmjs.com/package/morgan/v/1.1.1)
- [Helmet](http://helmetjs.github.io)
- [Knex](https://www.npmjs.com/package/knex)
- [Pg](https://www.npmjs.com/package/pg)
- [Postgrator-CLI](https://www.npmjs.com/package/postgrator-cli)
- [Chai](https://www.npmjs.com/package/chai)
- [Mocha](https://www.npmjs.com/package/mocha)
- [Supertest](https://www.npmjs.com/package/supertest)
- [Winston](https://www.npmjs.com/package/)
- [Xss](https://www.npmjs.com/package/xss)

## Database
The API relies on a PSQL database. This will need to be configured for data to be seeded or reset.

# Using the API
The API has endpoints for handling CRUD operations for the Flavor Logs and Eateries. Start the server and use [Postman](https://www.getpostman.com/) or a similar tool to test out the endpoints.

## Flavor Logs Endpoints
**GET** `/flavorLogs` <br>
Returns an array of all Flavor Logs in the database. Example response body:
```
[

        {
            "id": 1, 
            "title": "Best pho in town", 
            "info": "The broth is clear, flavorful, and not greasy at all! The rare steak was not overcooked; the flank was tender. The noodles were soft, but not too soft to break apart with chopsticks. Will go here again!",
            "ordered": "P13 - Rare Steak and Flank Beef Noodle Soup", 
            "rating": 5, 
            "date": "2019-11-10", 
            "image_link": "https://i.imgur.com/z9Avo11.jpg",
            "image_alt": "Bowl of pho with sauce and lime",
            "eatery_id": 1
        },
        {
            "id": 2, 
            "title": "Softest bread", 
            "info": "The lines were a little long, but worth it. Softest bread roll to start the day. The aroma was perfect, resembling a nice cup of freshly brewed coffee, and the flavor was not overbearing", 
            "ordered": "Morning Coffee Roll", 
            "rating": 4, 
            "date": "2019-09-05", 
            "image_link": "https://i.imgur.com/K2yhmFe.jpg",
            "image_alt": "Coffee Roll next to cup of latte",
            "eatery_id": 2
        },
        ...
]
```

**GET** `/flavorLogs/:flavorLog_id` <br>
Returns a Flavor Log corresponding to the correct ID. Example response body:
```
{
        {
            "id": 5, 
            "title": "Most savory dessert in the city", 
            "info": "The cheesecake is delectable. There is a savory sweetness within the entire dish dessert plate is delicate and flavor is overwhelming. The vanilla and chocolate contrast fits very well.",
            "ordered": "Oreogasm Cheesecake", 
            "rating": 5, 
            "date": "2020-01-04", 
            "image_link": "https://hips.hearstapps.com/vidthumb/images/delish-oreogasm-cheesecake-still004-1534418053.jpg",
            "image_alt": "Gluten Free New York Style Cheesecake",
            "eatery_id": 2
        },
}
```

**POST** `/flavorLogs` <br>
Posts to the Flavor Logs Endpoint and adds a Flavor Log to the database with a corresponding Eatery ID. See below for details on Eateries Endpoints. The ID for each Flavor Log is generated by the database. Example post request:
```
{
        {
            "id": 8, 
            "title": "Fluftacular Pancakes", 
            "info": "The pancakes were very fluffy, they had a wide selection of flavored syrups to choose from. The coffee wasn't very sweet, but that was due to my preference. It also did have the vanilla flavoring which wasn't overpowering.",
            "ordered": "Pancakes and a vanilla coffee.", 
            "rating": 5, 
            "date": "2020-01-08", 
            "image_link": "https://i.imgur.com/L7K00NP.jpg",
            "image_alt": "Panda pancakes",
            "eatery_id": 2
        },
}
```

**PATCH** `flavorLogs/:flavorLogs_id` <br>
Patches to the Flavor Logs Endpoint and updates a Flavor Log in the database. Example patch request:
```
{
        {
            "id": 4, 
            "title": "Smooth Noodles", 
            "info": "The broth was light and not overly greasy. The noodles were not too firm and not too soft.",
            "ordered": "Chicken and Leek Noodles in Light Broth.", 
            "rating": 5, 
            "eatery_id": 5
        },
}

```

**DELETE** `/flavorLogs/:flavorLogs_id` <br>
Deletes the Flavor Log corresponding to the ID from the request. This will not provide a response, but will remove the Flavor Log.

----

## Eateries Endpoints
**GET** `/eateries` <br>
Returns an array of all Eateries in the database. Example response body:
```
[
        {
            "id": 1,
            "name": "Pho Mignon",
            "phone": "760-320-5210",
            "address": "1235 North Island Street, San Diego, CA 92108",
            "notes": "Open M-F 9 am - 9 pm, Sat 9 am - 11 pm, Sun 10 am - 8 pm"
        },
        {
            "id": 2,
            "name": "200Â° Bakery",
            "phone": "619-280-7599",
            "address": "8590 Elm Wake Drive, San Diego, CA 92123",
            "notes": "Open M-F 7 am - 5 pm, Sat 7 am - 8 pm, Sun 9 am - 3 pm"
        },
        {
            "id": 3,
            "name": "Mana Noodlehouse",
            "phone": "858-780-2323",
            "address": "590 Convoy Street, San Diego, CA 92117",
            "notes": "Open M-F 11 am - 9 pm, Sat 11 am - 12 am, Sun 11 am - 6 pm"
        },
]
```

**GET** `/eateries/eatery_id` <br>
Returns an Eatery corresponding to the correct ID. Example response body:
```
[
        {
            "id": 4,
            "name": "Taco Bell",
            "phone": "619-448-0484",
            "address": "9825 Mission Gorge Rd, Santee, CA 92071",
            "notes": "Turns out this isn't actually Mexican food. Open Mon - Sun 9 am - 9 pm."
        }
]
```

**POST** `/eateries` <br>
Posts to the Eateries Endpoint and adds an Eatery to the database. The ID for each Eatery is generated by the database. Example post request:
```
{
        {
            "id": 5,
            "name": "Korean Fried Chicken",
            "phone": "808-329-9020"
            "address": "1 Infinity Loop, San Diego, CA 92071",
            "notes": "Open late on Saturday nights. It's good if you enjoy this kind of chicken."
        }
}
```

**PATCH** `eateries/:eatery_id` <br>
Patches to the Eateries Endpoint and updates an Eatery in the database. Example patch request:
```
{
        {
            "id": 5,
            "name": "Gyuk Korean BBQ",
            "notes": "Open late on Saturday nights. This place turned into an all-you-can-eat Korean BBQ place. Not too bad!"
        }
}
```

**DELETE** `/eateries/:eatery_id` <br>
Deletes the Eatery corresponding to the ID from the request. This will not provide a response, but will remove the Eatery and associated Flavor Logs from the database.

----

## Database
This API relies on a PSQL database, which you will need to create and configure to be able to test the data. 

### Creation
Use PSQL to create the local databases, 'flavorlogs' and 'flavorlogs-test'. Both should have a superuser 'flavorlogs_user'

```
$ createdb -U flavorlogs_user flavorlogs
$ createdb -U flavorlogs_user flavorlogs-test
```
If you choose to use different names or settings, please be sure to update the 'config.js' and '.env' files to match. You'll need to rename the 'example.env' file in order for the current configurations to work.

### Migration
Please use a Postgrator to migrate and add the schema:
```
$ npm run migrate
```
and
```
$ npm run migrate --0
```
if you ever need to reset the table data

### Seed
You may see the data by importing the seeds through the directory path leading to the seed file like below:
```
\i 'C:/Users/userName/projectFolder/flavor-logs-api/seeds/seed.flavorlogs_eateries.sql';

\i 'C:/Users/userName/projectFolder/flavor-logs-api/seeds/seed.flavorlogs_logs.sql';
```
or
```
$ psql -U flavorlogs_user -d flavorlogs -f ./seeds/seed.flavorlogs_eateries.sql
$ psql -U flavorlogs_user -d flavorlogs -f ./seeds.seed.flavorlogs_logs.sql
```

## Running the API
To start the server, you may run the following:
```
npm start
```
or
```
npm run dev
```
to start the Nodemon server

Run the tests:
```
npm test
```
